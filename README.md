# har-grab-plugin

*Note: currently this tool only supports chrome, chromium based browsers,*
*and firefox (which can support chrome plugins by default. IE/EdgeHTML support*
*may be added later, but it is not high priority as documentation is slim*

This is a simple chrome plugin meant to assist in automated testing with 
tools like selenium without having to deal with a proxy to get web traffic,
which can be a bit of a headache, particularly if you want to track websocket.

## How It Works
When I say simple, I do mean simple. It is a simple application of chrome's
`devtools.network` api that gets the HAR that is generated by chrome's devtools
panel. So, for this to function, devtools has to be open. More on that in the
usage instructions. After it gets the har, it puts it at `document.har` so it
can be accessed by any automated testing framework that has access to the
javascript console.

## Advantages
Depending on what you are testing, it may be difficult to get a proxy to function
in a way that you can obtain a full har dump. Furthermore, performance logs, which
are what Chrome Devtools Protocol uses, may not include all the needed information
This creates a complete HAR dump

## Drawbacks
The har dump is triggered by a keyboard shortcut, meaning the browser must be
focused. Unfortunately chrome currently doesn't read selenium inputs as browser inputs,
so something like `java.awt.Robot`, Sikuli, or some equivalent system in python should 
be used. This means the window will need to run with head on and be focused during the tests

*note: in future, I may be able to implement a function that is automatically 
defined which can trigger the dump. I'm not entirely sure if this is possible though* 


## Usage

### Step 1: Pack the Extension
For Chrome:
    1. Go to `chrome://extensions`
    2. Turn on "Developer Mode" in the upper right hand corner if it is not already on
    3. Click 'Pack Extension'
    4. Select the folder `har-grab-plugin/src` and do not select a license.
    5. A `.crx` file and `.pem` file has been generated. The `.pem` is not needed unless
    you intend on modifying the plugin for some easier parsing of the HAR.

For Firefox:
    1. Navigate to `har-grab-plugin/src` in a file manager or terminal
    2. Add all files in the directory to a zip directory with a name of your choosing


### Step 2: Use the extension
In Python for Chrome (with pyautogui):
```python
from selenium import webdriver
import pyautogui

options = webdriver.ChromeOptions()
options.add_argument("--auto-open-devtools-for-tabs")
options.add_extension('path/to/file')

driver = webdriver.Chrome(chrome_options=options)

driver.get("https://google.com/")

pyautogui.keyDown("ctrl")
pyautogui.keyDown("shift")
pyautogui.keyDown("y")
pyautogui.keyUp("ctrl")
pyautogui.keyUp("shift")
pyautogui.keyUp("y")

har = driver.execute_script("return JSON.stringify(document.har)")
```

In Python for Firefox:
```python
from selenium import webdriver
from selenium.webdriver.common.keys import Keys

profile = webdriver.FirefoxProfile()
profile.add_extension('path/to/file')

driver = webdriver.Firefox(firefox_profile=profile)

driver.get("https://google.com/")
driver.find_element_by_tag_name("body").send_keys(Keys.F12)

driver.find_element_by_tag_name("body").send_keys(Keys.CTRL + Keys.SHIFT + 'y')

har = driver.execute_script("return JSON.stringify(document.har)")
```